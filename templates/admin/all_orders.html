{% extends "admin/admin_base.html" %}

{% block page_title %}All Orders{% endblock %}

{% block content %}
<div class="admin-card">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
        <h4 class="fw-bold mb-0">{% if is_super %}Platform Orders{% else %}My Orders{% endif %}</h4>

        <form method="GET" action="{{ url_for('admin.all_orders') }}" class="d-flex gap-2">
            <input type="hidden" name="aid" value="{{ session.get('admin_id') }}">
            <div class="input-group input-group-sm">
                <input type="text" name="search_order" class="form-control" placeholder="ID or Customer Name..."
                    value="{{ request.args.get('search_order', '') }}" style="min-width: 200px;">
                <select name="status_filter" class="form-select">
                    <option value="">All Status</option>
                    <option value="paid" {% if request.args.get('status_filter')=='paid' %}selected{% endif %}>Paid
                    </option>
                    <option value="pending" {% if request.args.get('status_filter')=='pending' %}selected{% endif %}>
                        Pending</option>
                    <option value="Completed (Mock)" {% if request.args.get('status_filter')=='Completed (Mock)'
                        %}selected{% endif %}>Mock</option>
                </select>
                <button class="btn btn-primary" type="submit">
                    <i class="bi bi-search"></i>
                </button>
                {% if request.args.get('search_order') or request.args.get('status_filter') %}
                <a href="{{ url_for('admin.all_orders', aid=request.args.get('aid') if request.args.get('aid') else session.get('admin_id')) }}"
                    class="btn btn-outline-secondary">
                    <i class="bi bi-x-lg"></i> Clear
                </a>
                {% endif %}
            </div>
        </form>

        <span class="badge bg-primary px-3 py-2">{{ orders|length }} Total Orders</span>
    </div>

    <div class="table-responsive">
        <table class="table table-hover align-middle border-light">
            <thead class="bg-light">
                <tr>
                    <th class="border-0 rounded-start">Order ID</th>
                    <th class="border-0">Customer</th>
                    <th class="border-0">Amount</th>
                    <th class="border-0">Shipping Address</th>
                    <th class="border-0">Status</th>
                    <th class="border-0 rounded-end">Date</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td class="fw-bold text-primary">#{{ order.order_id }}</td>
                    <td>
                        <div class="fw-semibold">{{ order.customer_name }}</div>
                        <small class="text-muted">ID: #{{ order.user_id }}</small>
                    </td>
                    <td class="fw-bold">â‚¹{{ '{:,.2f}'.format(order.amount) }}</td>
                    <td>
                        <small class="text-muted" style="white-space: pre-line;">{{ order.shipping_address }}</small>
                    </td>
                    <td>
                        <span
                            class="badge rounded-pill {% if order.payment_status in ['paid', 'Completed (Mock)'] %}bg-success-subtle text-success{% else %}bg-warning-subtle text-warning{% endif %} px-3">
                            {{ order.payment_status }}
                        </span>
                    </td>
                    <td class="text-muted small">
                        {{ order.created_at|strftime('%d %b %Y, %H:%M') }}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center py-5 text-muted">
                        <i class="bi bi-cart-x fs-1 d-block mb-3"></i>
                        No orders found in the system.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}