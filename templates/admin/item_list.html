{% extends "admin/admin_base.html" %}

{% block page_title %}Product Inventory{% endblock %}

{% block content %}
<div class="admin-card">
    <div class="row g-3 mb-4">
        <div class="col-md-10">
            <form method="GET" action="" class="input-group">
                <!-- Keep aid in URL for multi-session support if needed -->
                <input type="hidden" name="aid" value="{{ session.get('admin_id') }}">

                <span class="input-group-text bg-white"><i class="bi bi-search text-muted"></i></span>
                <input type="text" name="search" class="form-control" placeholder="Search by name..."
                    value="{{ request.args.get('search', '') }}">

                <select name="category" class="form-select" style="max-width: 200px;">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                    <option value="{{ cat.category }}" {% if request.args.get('category')==cat.category %} selected {%
                        endif %}>
                        {{ cat.category }}
                    </option>
                    {% endfor %}
                </select>

                <button class="btn btn-primary px-4" type="submit">Apply Filters</button>

                {% if request.args.get('search') or request.args.get('category') %}
                <a href="{{ url_for('admin.item_list') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-x-lg"></i> Clear
                </a>
                {% endif %}
            </form>
        </div>

        <div class="col-md-2 text-end">
            {% if not view_only %}
            <a href="{{ url_for('admin.add_item_page') }}" class="btn btn-success w-100">
                <i class="bi bi-plus-lg"></i> Add New
            </a>
            {% else %}
            <span class="text-muted small">Viewing <strong>{{ target_admin_name }}'s</strong> inventory</span>
            {% endif %}
        </div>
    </div>

    <div class="table-responsive">
        <table class="table admin-table align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Image</th>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Price</th>
                    <th>Stock</th>
                    <th class="text-center">{% if not view_only %}Actions{% else %}Details{% endif %}</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>#{{ product.product_id }}</td>
                    <td>
                        {% if product.image %}
                        <img src="{{ url_for('static', filename='uploads/product_images/' + product.image) }}"
                            alt="{{ product.name }}" width="50" height="50" class="rounded object-fit-cover shadow-sm">
                        {% else %}
                        <div class="inventory-img-placeholder">
                            <i class="bi bi-image" style="font-size: 1.2rem;"></i>
                        </div>
                        {% endif %}
                    </td>
                    <td class="fw-medium">{{ product.name }}</td>
                    <td><span class="badge bg-light text-dark border">{{ product.category }}</span></td>
                    <td class="fw-bold text-primary">â‚¹{{ "{:,.2f}".format(product.price|float) }}</td>
                    <td>
                        {% if product.stock <= 5 %} <span class="badge bg-danger">Low Stock: {{ product.stock }}</span>
                            {% else %}
                            <span class="badge bg-success">{{ product.stock }}</span>
                            {% endif %}
                    </td>
                    <td class="text-center">
                        <div class="btn-group">
                            <a href="{{ url_for('admin.view_item', item_id=product.product_id) }}"
                                class="btn btn-sm btn-outline-info" title="View">
                                <i class="bi bi-eye"></i>
                            </a>
                            {% if not view_only %}
                            <a href="{{ url_for('admin.update_item_page', item_id=product.product_id) }}"
                                class="btn btn-sm btn-outline-warning" title="Update">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a href="{{ url_for('admin.delete_item', item_id=product.product_id) }}"
                                class="btn btn-sm btn-outline-danger"
                                onclick="return confirm('Are you sure you want to delete this product?')"
                                title="Delete">
                                <i class="bi bi-trash"></i>
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="7" class="text-center py-5">
                        <i class="bi bi-inbox fs-1 text-muted d-block"></i>
                        No products found.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}